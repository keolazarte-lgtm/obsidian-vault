<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://yzvguhnugravgboaiykk.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_SRNetS2rHOqjhITdz9I3UQ_e0hMef0U';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function ejecutarCompra(monto, creador) {
            console.log("Iniciando registro de pago...");
            const comisionObsidian = monto * 0.15;
            const pagoCreador = monto - comisionObsidian;

            try {
                // Forzamos el nombre de la tabla a 'balances'
                const { data, error } = await _supabase
                    .from('balances') 
                    .insert([
                        { 
                            creator_name: creador, // Asegurate que en Supabase termine en 'e'
                            total_gross: monto, 
                            platform_fee: comisionObsidian, 
                            creator_net: pagoCreador 
                        }
                    ]);

                if (error) {
                    console.error("Error detallado de Supabase:", error);
                    alert("Error de conexión: " + error.message);
                    return;
                }

                alert("¡Éxito! Pago registrado en la base de datos.");
                location.reload(); // Recarga para ver el saldo

            } catch (err) {
                console.error("Error crítico:", err);
                alert("El botón no pudo conectar con la base de datos.");
            }
        }
    </script>
